<services>
<service verb="create" noun="Person" authenticate="anonymous-all">
    <in-parameters>
        <parameter name="firstName" required="true">
            <matches regexp="\D*" message="Can not contain numbers"/>
        </parameter>
        <parameter name="lastName" required="true">
            <matches regexp="\D*" message="Can not contain numbers"/>
        </parameter>
        <parameter name="contactNumber" required="true">
            <matches regexp="^\d{3}-\d{3}-\d{4}$" message="Phone number format must be XXX-XXX-XXXX and must only contain numbers"/>
        </parameter>
        <parameter name="emailAddress" required="true">
            <matches regexp="^[a-zA-Z0-9.!#$%'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])+\.(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$"
            message="Please enter a valid email address."/>
        </parameter>
        <parameter name="requestName" required="true">
            <matches regexp="[(\w\W)]{5,}" message="Subject must be at least 5 characters long."/>
        </parameter>
        <parameter name="description" required="true">
            <matches regexp="[(\w\W)]{20,}" message="Description must be at least 20 characters long."/>
        </parameter>
        </in-parameters>

    <out-parameters>
        <parameter name="partyId"/>
    </out-parameters>

    <actions>
        <service-call name="mantle.party.PartyServices.create#Person" in-map="context" out-map="context"/>
        
        <set field="partyId" from="partyId"/>
        <set field="contactMechPurposeId" value="EmailPrimary"/>
        <service-call name="mantle.party.ContactServices.create#EmailAddress" in-map="context" out-map="context"/>
        
        <set field="partyId" from="partyId"/>
        <set field="contactMechPurposeId" value="PhonePrimary"/>
        <service-call name="mantle.party.ContactServices.create#TelecomNumber" in-map="context" out-map="context"/>

        <set field="filedByPartyId" from="partyId"/>
        <service-call name="mantle.request.RequestServices.create#Request" in-map="context" out-map="context"/>
    </actions>
</service>
</services> 